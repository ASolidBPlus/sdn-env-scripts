#!/usr/bin/env bash
# mn-host — Enter a Mininet host's namespace with a labelled terminal
# Usage: mn-host h1

set -euo pipefail

if [ $# -ne 1 ]; then
  echo "Usage: $(basename "$0") <mininet-host>" >&2
  exit 1
fi

HOST="$1"

# Get the namespace PID
PID=$(pgrep -f "mininet:${HOST}") || {
  echo "❌ Mininet host '$HOST' not found." >&2
  exit 1
}

# Colourful prompt and terminal tab title
TAB_TITLE="\033]0;${HOST}@mininet\007"
CUSTOM_PS1="\[\e[1;32m\]${HOST}@mininet:\w\$ \[\e[0m\]"

# Attach and run inside the namespace
sudo mnexec -a "$PID" bash --norc -c "
  echo -ne '${TAB_TITLE}'
  PS1='${CUSTOM_PS1}'
  exec bash --norc --noprofile
"
